#include<stdlib.h>#include<assert.h>#include<time.h>#include<SDL2/SDL.h>#include<SDL2/SDL_image.h>#include "HBB_Draw.h"#include "NH_Algorithm.h"#include <SDL2/SDL_mixer.h>#define HBB_WINDOW_W 800#define HBB_WINDOW_H 600#define MUS_PATH "music/pokemon.mp3"#define LEVEL1_PATH "music/mario.mp3"#define LEVEL2_PATH "music/jotho.mp3"#define LEVEL3_PATH "music/pirates.mp3"#define LEVEL4_PATH "music/stage.mp3"#define LEVEL5_PATH "music/world.mp3"Mix_Music *music = NULL;Mix_Music *level1 = NULL;Mix_Music *level2 = NULL;Mix_Music *level3 = NULL;Mix_Music *level4 = NULL;Mix_Music *level5 = NULL;int main(int argc, char ** argv){	   // NE TOUCHEZ RIEN	  int Event_LeftMouseButtonDown = 0;	  int Event_Quit = 0;	  int MUSIC_PLAYON = 0;	  SDL_Event event;	  SDL_Init(SDL_INIT_VIDEO);	  SDL_Window * window = SDL_CreateWindow("SDL2 Snake 3D", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, HBB_WINDOW_W, HBB_WINDOW_H, 0);	  SDL_Renderer * renderer = SDL_CreateRenderer(window, -1, 0);	  SDL_Texture * texture = SDL_CreateTexture(renderer,SDL_PIXELFORMAT_ARGB8888,SDL_TEXTUREACCESS_STATIC,HBB_WINDOW_W,HBB_WINDOW_H);	  Uint32 * pixels = (Uint32 *)malloc(HBB_WINDOW_W *HBB_WINDOW_H*sizeof(Uint32));	  memset(pixels, 0, HBB_WINDOW_H * HBB_WINDOW_W * sizeof(Uint32));		if (SDL_Init(SDL_INIT_AUDIO) < 0)			return -1;					//Initialize SDL_mixer 		if(Mix_OpenAudio( 22050, MIX_DEFAULT_FORMAT, 2, 4096 ) == -1 ) 			return -1;				// Load our music		music = Mix_LoadMUS(MUS_PATH);		level1 = Mix_LoadMUS(LEVEL1_PATH);		level2 = Mix_LoadMUS(LEVEL2_PATH);		level3 = Mix_LoadMUS(LEVEL3_PATH);		level4 = Mix_LoadMUS(LEVEL4_PATH);		level5 = Mix_LoadMUS(LEVEL5_PATH);		if (music == NULL)		return -1;		assert(level1);		assert(level2);		assert(level3);		assert(level4);		assert(level5);			if ( Mix_PlayMusic( music, -1) == -1 )		  return -1;				// NE TOUCHEZ RIEN	  	 	NH_init_snake();		CHARLIE_init_GAMESTATE();	 	CHARLIE_init_IMAGE();		  	    _GamePage=1;	  	  	  while (!Event_Quit){		    SDL_UpdateTexture(texture, NULL, pixels, HBB_WINDOW_W* sizeof(Uint32));	    if((_GamePage==GAMEPAGE_MAINMENU||_GamePage==GAMEPAGE_STAGEMENU)	       &&(!_AnimationTimer || SDL_GetTicks()-_AnimationTimer>200)){		      _AnimationTimer = SDL_GetTicks();	      _Horloge=-_Horloge;  	      HBB_drawMenu(pixels,HBB_WINDOW_W,HBB_WINDOW_H,_GamePage,_Horloge);	      Mix_PlayingMusic();	    	  }		else if(_GamePage==GAMEPAGE_LEVEL1 &&(!_AnimationTimer || SDL_GetTicks()-_AnimationTimer>_RapiditeLevel[0])){	_AnimationTimer = SDL_GetTicks(); 	 if(MUSIC_PLAYON==0){	   if ( Mix_PlayMusic(level1, -1) == -1 ) return -1;	   MUSIC_PLAYON=1;	}	    if(_MouvementSnake==MOUVEMENT_CONTINUE){	      NH_deplacement(HBB_earth2,10,10);	      	    }	    if(_GameOver==GAMEOVER_OUI){	      _MouvementSnake=MOUVEMENT_GAMEOVER;	      HBB_drawImgGameover(pixels,HBB_WINDOW_W,HBB_WINDOW_H,(Uint32 *)IMG_gameover->pixels,IMG_gameover->w,IMG_gameover->h,positionGameover.x,positionGameover.y,0);	    }	    if(_GameOver==GAMEOVER_NON){	      NH_affiche(HBB_earth2,10,10);	      HBB_drawStageTerre(pixels,HBB_WINDOW_W,HBB_WINDOW_H,29);	      	    }	 	    HBB_drawScoreBoard(pixels,HBB_WINDOW_W,HBB_WINDOW_H,SCORE,350,350);	      _GameOver=NH_gameover(HBB_earth2,10,10);	  	   	  }else if(_GamePage==GAMEPAGE_LEVEL3 &&(!_AnimationTimer || SDL_GetTicks()-_AnimationTimer>_RapiditeLevel[1])){	    	    _AnimationTimer = SDL_GetTicks();	    if(MUSIC_PLAYON==0){	      if ( Mix_PlayMusic(level3, -1) == -1 ) return -1;	      MUSIC_PLAYON=1;	    }	    if(_MouvementSnake==MOUVEMENT_CONTINUE){	      NH_deplacement(HBB_volcan1,20,20);	    }	    if(_GameOver==GAMEOVER_NON){	      NH_affiche(HBB_volcan1,20,20);			HBB_drawStageVolcan(pixels,HBB_WINDOW_W,HBB_WINDOW_H,17);				    }	      			    if(_GameOver==GAMEOVER_OUI){	      _MouvementSnake=MOUVEMENT_GAMEOVER;	      HBB_drawImgGameover(pixels,HBB_WINDOW_W,HBB_WINDOW_H,(Uint32 *)IMG_gameover->pixels,IMG_gameover->w,IMG_gameover->h,positionGameover.x,positionGameover.y,0);	    }	    	    HBB_drawScoreBoard(pixels,HBB_WINDOW_W,HBB_WINDOW_H,SCORE,350,350);	      _GameOver=NH_gameover(HBB_volcan1,20,20);	    	  }else if(_GamePage==GAMEPAGE_LEVEL4		   &&(!_AnimationTimer || SDL_GetTicks()-_AnimationTimer>_RapiditeLevel[2])){	    	    _AnimationTimer = SDL_GetTicks();	    if(MUSIC_PLAYON==0){	   if ( Mix_PlayMusic(level4, -1) == -1 ) return -1;	   MUSIC_PLAYON=1;	    }		    if(_MouvementSnake==MOUVEMENT_CONTINUE){		      NH_deplacement_3D(MAP3Dtoit,21,21,MAP3Dleft,21,20,MAP3Dright,20,20);	      _GameOver=NH_gameover_3D(MAP3Dtoit,21,21,MAP3Dleft,21,20,MAP3Dright,20,20);		}	    if(_GameOver==GAMEOVER_NON){	      NH_affiche_3D(MAP3Dtoit,21,21,MAP3Dleft,21,20,MAP3Dright,20,20);	      HBB_drawStage3D(pixels,HBB_WINDOW_W,HBB_WINDOW_H,MAP3Dtoit,21,21,MAP3Dleft,21,20,MAP3Dright,20,20);	    }	    if(_GameOver==GAMEOVER_OUI){	      _MouvementSnake=MOUVEMENT_GAMEOVER;	      HBB_drawImgGameover(pixels,HBB_WINDOW_W,HBB_WINDOW_H,(Uint32 *)IMG_gameover->pixels,IMG_gameover->w,IMG_gameover->h,positionGameover.x,positionGameover.y,0);	    }	    HBB_drawScoreBoard(pixels,HBB_WINDOW_W,HBB_WINDOW_H,SCORE,400,430);	    	    }else if(_GamePage==GAMEPAGE_LEVEL2		     &&(!_AnimationTimer || SDL_GetTicks()-_AnimationTimer>_RapiditeLevel[3])){	    	    _AnimationTimer = SDL_GetTicks();	    if(MUSIC_PLAYON==0){	   if ( Mix_PlayMusic(level2, -1) == -1 ) return -1;	   MUSIC_PLAYON=1;	    }	    if(_MouvementSnake==MOUVEMENT_CONTINUE){	      NH_deplacement(CHARLIE_earth2,10,10);	    }	    	    if(_GameOver==GAMEOVER_NON){	      NH_affiche(CHARLIE_earth2,10,10);	      CHARLIE_drawStagerand(pixels,HBB_WINDOW_W,HBB_WINDOW_H,29);	     	}	     if(_GameOver==GAMEOVER_OUI){			_MouvementSnake=MOUVEMENT_GAMEOVER;				HBB_drawImgGameover(pixels,HBB_WINDOW_W,HBB_WINDOW_H,(Uint32 *)IMG_gameover->pixels,IMG_gameover->w,IMG_gameover->h,positionGameover.x,positionGameover.y,0);			}	HBB_drawScoreBoard(pixels,HBB_WINDOW_W,HBB_WINDOW_H,SCORE,350,350);	      _GameOver=NH_gameover(CHARLIE_earth2,10,10);	    		}else if(_GamePage==GAMEPAGE_LEVEL5		&&(!_AnimationTimer || SDL_GetTicks()-_AnimationTimer>_RapiditeLevel[4])){	  _AnimationTimer = SDL_GetTicks();	    if(MUSIC_PLAYON==0){	  if ( Mix_PlayMusic(level5, -1) == -1 ) return -1;	   MUSIC_PLAYON=1;	 }	  	if(_MouvementSnake==MOUVEMENT_CONTINUE){	    	NH_deplacement_3D(MAP3Dtoit,17,17,MAP3Dleft,17,15,MAP3Dright,16,15);		_GameOver=NH_gameover_3D(MAP3Dtoit,17,17,MAP3Dleft,17,15,MAP3Dright,16,15); 		}	    if(_GameOver==GAMEOVER_NON){			NH_affiche_3D(MAP3Dtoit,17,17,MAP3Dleft,17,15,MAP3Dright,16,15);			HBB_drawStageRainbow(pixels,HBB_WINDOW_W,HBB_WINDOW_H);	    }    if(_GameOver==GAMEOVER_OUI){		_MouvementSnake=MOUVEMENT_GAMEOVER;		HBB_drawImgGameover(pixels,HBB_WINDOW_W,HBB_WINDOW_H,(Uint32 *)IMG_gameover->pixels,IMG_gameover->w,IMG_gameover->h,positionGameover.x,positionGameover.y,0);	}	HBB_drawScoreBoard(pixels,HBB_WINDOW_W,HBB_WINDOW_H,SCORE,400,400); 	}    while(SDL_PollEvent(&event))      switch (event.type){      case SDL_KEYDOWN:	switch(event.key.keysym.sym) {	case SDLK_RIGHT:	  if(_GamePage==GAMEPAGE_STAGEMENU){	  	if(positionArrow.x<550)positionArrow.x+=100;	  }else{	      if(_MouvementSnake==MOUVEMENT_STOP_TO_START			&&_GamePage>GAMEPAGE_STAGEMENU)			_MouvementSnake=MOUVEMENT_CONTINUE;		    	if(snake[0].direction!=Left)snake[0].direction=Right;	    }	  break;	case SDLK_LEFT:	  if(_GamePage==GAMEPAGE_STAGEMENU){	  	if(positionArrow.x>150)positionArrow.x-=100;	  }else{	      if(_MouvementSnake==MOUVEMENT_STOP_TO_START&&_GamePage>GAMEPAGE_STAGEMENU)		  	_MouvementSnake=MOUVEMENT_CONTINUE;		    if(snake[0].direction!=Right)snake[0].direction=Left;			  }	    	  break;	case SDLK_UP:	  if(_MouvementSnake==MOUVEMENT_STOP_TO_START&&_GamePage>GAMEPAGE_STAGEMENU)	  	_MouvementSnake=MOUVEMENT_CONTINUE;	    if(snake[0].direction!=Down)snake[0].direction=Up;		  	  break;	case SDLK_DOWN:	  if(_MouvementSnake==MOUVEMENT_STOP_TO_START&&_GamePage>GAMEPAGE_STAGEMENU)	  	_MouvementSnake=MOUVEMENT_CONTINUE;	  if(snake[0].direction!=Up)snake[0].direction=Down;	  break;	case SDLK_q :	case SDLK_ESCAPE :	  Event_Quit = 1;	  break;	case 8:	  NH_init_snake();	  HBB_reinitAllStage();	  MUSIC_PLAYON=0;	  if ( Mix_PlayMusic(music, -1) == -1 ) return -1;	  SCORE=0;	  _MouvementSnake=MOUVEMENT_STOP_TO_START;	  if(_GamePage==GAMEPAGE_STAGEMENU)	  _GamePage=GAMEPAGE_MAINMENU;	  	  if(_GamePage>GAMEPAGE_STAGEMENU)	  _GamePage = GAMEPAGE_STAGEMENU;	  	  if(_GameOver==GAMEOVER_OUI)	  _GameOver = GAMEOVER_NON;	  break;	case 13:	  if(_GamePage==GAMEPAGE_MAINMENU) 		_GamePage = GAMEPAGE_STAGEMENU;	  else{	    if(_GamePage==GAMEPAGE_STAGEMENU&&positionArrow.x==150)_GamePage=GAMEPAGE_LEVEL1;	    if(_GamePage==GAMEPAGE_STAGEMENU&&positionArrow.x==250)_GamePage=GAMEPAGE_LEVEL2;	    if(_GamePage==GAMEPAGE_STAGEMENU&&positionArrow.x==350)_GamePage=GAMEPAGE_LEVEL3;	    if(_GamePage==GAMEPAGE_STAGEMENU&&positionArrow.x==450)_GamePage=GAMEPAGE_LEVEL4;	    if(_GamePage==GAMEPAGE_STAGEMENU&&positionArrow.x==550)_GamePage=GAMEPAGE_LEVEL5;	  }	    break;	default:	  break;	}	break;      case SDL_MOUSEBUTTONUP:	if (event.button.button == SDL_BUTTON_LEFT)	  Event_LeftMouseButtonDown = 0;	break;      case SDL_MOUSEBUTTONDOWN:	if (event.button.button == SDL_BUTTON_LEFT)	  Event_LeftMouseButtonDown = 1;	        case SDL_MOUSEMOTION:	if (Event_LeftMouseButtonDown	    && event.button.y >  positionStart.y	    && event.button.y <=  positionStart.y+IMG_start->h	    && event.button.x >  positionStart.x	    && event.button.x <=  positionStart.x+IMG_start->w	    && _GamePage==GAMEPAGE_MAINMENU)	  _GamePage=GAMEPAGE_STAGEMENU;	      	int bouton;	for(bouton=0;bouton<5;bouton++) {     	  if (Event_LeftMouseButtonDown	      && event.button.y >  positionLevel[bouton].y	      && event.button.y <=  positionLevel[bouton].y+IMG_level[bouton]->h	      && event.button.x >  positionLevel[bouton].x	      && event.button.x <=  positionLevel[bouton].x+IMG_level[bouton]->w	      && _GamePage==GAMEPAGE_STAGEMENU)		  	_GamePage=GAMEPAGE_LEVEL1 + bouton;	}	break;       case SDL_QUIT:		Event_Quit = 1;	break;	}    SDL_RenderClear(renderer);    SDL_RenderCopy(renderer, texture, NULL, NULL);    SDL_RenderPresent(renderer);  }	// clean up our resources	Mix_FreeMusic(music);		// quit SDL_mixer	Mix_CloseAudio();  free(pixels);  free(snake);  SDL_DestroyTexture(texture);  SDL_DestroyRenderer(renderer);  SDL_DestroyWindow(window);  SDL_Quit();  return 0;}